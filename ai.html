<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>J.A.R.V.I.S</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{--glow:#00f2ff;--bg:#000d11;--glass:rgba(0,242,255,.12)}
body{
  margin:0;
  background:var(--bg);
  color:var(--glow);
  font-family:Courier New, monospace;
  padding:15px;
  height:100vh;
  display:flex;
  flex-direction:column
  background:var(--glass);
  padding:10px;
  border-radius:10px;
  overflow:auto;
  margin:10px 0
}
.msg{margin-bottom:10px}
.user{color:#fff}
.jarvis{color:var(--glow)}
.system{color:#666;font-style:italic}
.controls{display:flex;gap:6px}
input{
  flex:1;
  background:transparent;
  border:none;
  color:#fff;
  outline:none
}
button{
  background:none;
  border:none;
  color:var(--glow);
  font-size:18px
}
video{
  display:none;
  width:100%;
  border-radius:10px
}
</style>
</head>

<body>

<div id="arc"></div>

<video id="video" autoplay playsinline></video>
<canvas id="canvas" hidden></canvas>

<div id="chat">
  <div class="msg jarvis">Systems online. Awaiting your command, Sir.</div>
</div>

<div class="controls">
  <button onclick="startVoice()">üéôÔ∏è</button>
  <input id="input" placeholder="Type command">
  <button onclick="startCamera()">üì∑</button>
  <button onclick="send()">‚û§</button>
</div>

<script>
/* ================= CONFIG ================= */
// üî¥ PUT YOUR GEMINI API KEY HERE
const GEMINI_KEY = "AIzaSyBZRyrS8wtbnYz6j_edg8eqsNtKMSkyT38";
/* ========================================= */

const chat = document.getElementById("chat");
const input = document.getElementById("input");
const video = document.getElementById("video");

function log(cls,text){
  chat.innerHTML += `<div class="msg ${cls}">${text}</div>`;
  chat.scrollTop = chat.scrollHeight;
}

function speak(text){
  log("jarvis", text);
  const u = new SpeechSynthesisUtterance(text);
  u.rate = 0.95;
  speechSynthesis.speak(u);
}

/* ================= GEMINI TEXT ================= */
async function askGemini(prompt){
  try{
    const r = await fetch(
      `https://generativelanguage.googleapis.com/v1beta/models/gemini-3.5-flash:generateContent?key=${GEMINI_KEY}`,
      {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify({
          contents:[{
            parts:[{ text:`You are JARVIS. Calm, intelligent, British tone. Call the user Sir.\n\n${prompt}` }]
          }]
        })
      }
    );
    const d = await r.json();
    return d.candidates[0].content.parts[0].text;
  }catch{
    return "Sir, my systems are temporarily unavailable.";
  }
}

/* ================= SEND ================= */
async function send(){
  if(!input.value) return;
  const q = input.value;
  input.value = "";
  log("user", q);
  log("system", "Processing‚Ä¶");
  speak(await askGemini(q));
}

/* ================= VOICE ================= */
function startVoice(){
  const r = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  r.lang = "en-US";
  r.onresult = e=>{
    input.value = e.results[0][0].transcript;
    send();
  };
  r.start();
}

/* ================= CAMERA (VISION) ================= */
async function startCamera(){
  video.style.display = "block";
  const stream = await navigator.mediaDevices.getUserMedia({ video:true });
  video.srcObject = stream;

  setTimeout(async ()=>{
    const c = document.getElementById("canvas");
    c.width = video.videoWidth;
    c.height = video.videoHeight;
    c.getContext("2d").drawImage(video,0,0);
    const img = c.toDataURL("image/jpeg").split(",")[1];
    stream.getTracks().forEach(t=>t.stop());
    video.style.display = "none";

    try{
      const r = await fetch(
        `https://generativelanguage.googleapis.com/v1beta/models/gemini-3.0-flash:generateContent?key=${GEMINI_KEY}`,
        {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body:JSON.stringify({
            contents:[{
              parts:[
                { text:"Describe what you see like JARVIS." },
                { inline_data:{ mime_type:"image/jpeg", data:img } }
              ]
            }]
          })
        }
      );
      const d = await r.json();
      speak(d.candidates[0].content.parts[0].text);
    }catch{
      speak("Optical scan failed, Sir.");
    }
  },3000);
}
</script>

</body>
</html>
